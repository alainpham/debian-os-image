#!/bin/bash
# This script is used to set the monitor configuration for X11.

command=$1

if [ "$command" == "help" ]; then
    echo "Usage: $0 <command>"
    echo "Commands:"
    echo "  lap     - Show only laptop screen"
    echo "  hdmi    - Show HDMI only"
    echo "  mirror  - Mirror HDMI to laptop screen"
    echo "  hleft   - Show HDMI left of laptop screen"
    echo "  hright  - Show HDMI right of laptop screen"
    echo "  <empty> - Default docking station or laptop only"
    exit 1
fi

# List available monitors using xrandr
monitors=$(xrandr --query | grep " connected" | awk '{ print $1 }')
echo "Available monitors: $monitors"
if [ "$PRODUCT_NAME" == "21MCCTO1WW" ] ; then
    echo "Lenovo T14 AMD detected, setting monitor configuration..."
    dock_left="DisplayPort-6"
    if echo "$monitors" | grep -q "DisplayPort-7"; then
        dock_center="DisplayPort-7"
    else
        dock_center="DisplayPort-8"
    fi
    laptop="eDP"
    laptop_mode="1920x1200"
    hdmi="HDMI-A-0"
elif [ "$PRODUCT_NAME" == "Dell G15 5520" ]; then
    echo "Dell G15 5520 detected, setting monitor configuration..."
    if echo "$monitors" | grep -q "DP-1-3"; then
        dock_left="DP-1-3"
    else
        dock_left="DP-1-1"
    fi
    dock_center="DP-1-2"
    laptop="eDP-1"
    laptop_mode="1920x1080"
    hdmi="HDMI-1-0"
else
    echo "Unknown product name: $PRODUCT_NAME"
    exit 0
fi


echo "Available monitors:"
for monitor in $monitors; do
    echo "- $monitor"
done

lap() {
    echo "Laptop screen only."
    xrandr --output $laptop --mode $laptop_mode --pos 0x0 --rate 60 --rotate normal --primary
    for monitor in $monitors; do
        if [ "$monitor" != "$laptop" ]; then
            xrandr --output "$monitor" --off
        fi
    done
}

if [ "$command" == "lap" ]; then
    
    lap

elif [ "$command" == "hdmi" ] && echo "$monitors" | grep -q "$hdmi" ; then
    
    echo "HDMI screen only"
    xrandr --output $hdmi --mode 1920x1080 --pos 0x0 --rate 60 --rotate normal --primary
    for monitor in $monitors; do
        if [ "$monitor" != "$hdmi" ]; then
            xrandr --output "$monitor" --off
        fi
    done

elif [ "$command" == "mirror" ] && echo "$monitors" | grep -q "$hdmi" ; then

    echo "HDMI & Laptop screen mirroring"
    xrandr \
        --output $laptop --mode $laptop_mode --pos 0x0 --rate 60 --rotate normal --primary \
        --output $hdmi --mode 1920x1080 --pos 0x0 --rate 60 --rotate normal

    for monitor in $monitors; do
        if [ "$monitor" != "$hdmi" ] && [ "$monitor" != "$laptop" ]; then
            xrandr --output "$monitor" --off
        fi
    done

elif [ "$command" == "hleft" ] && echo "$monitors" | grep -q "$hdmi" ; then

    echo "HDMI left of Laptop screen"
    xrandr \
        --output $laptop --mode $laptop_mode --pos 0x0 --rate 60 --rotate normal --primary \
        --output $hdmi --mode 1920x1080 --pos -1920x0 --rate 60 --rotate normal

    for monitor in $monitors; do
        if [ "$monitor" != "$hdmi" ] && [ "$monitor" != "$laptop" ]; then
            xrandr --output "$monitor" --off
        fi
    done

elif [ "$command" == "hright" ] && echo "$monitors" | grep -q "$hdmi" ; then

    echo "HDMI right of Laptop screen"
    xrandr \
        --output $laptop --mode $laptop_mode --pos 0x0 --rate 60 --rotate normal --primary \
        --output $hdmi --mode 1920x1080 --pos 1920x0 --rate 60 --rotate normal

    for monitor in $monitors; do
        if [ "$monitor" != "$hdmi" ] && [ "$monitor" != "$laptop" ]; then
            xrandr --output "$monitor" --off
        fi
    done

elif echo "$monitors" | grep -q "$dock_left" && echo "$monitors" | grep -q "$dock_center"; then
    echo "Docking station detected, setting up DisplayPort monitors."
        xrandr \
            --output $dock_left   --mode 1920x1080      --pos 0x0       --rate 60   --rotate normal --primary \
            --output $dock_center --mode 1920x1080      --pos 1920x0    --rate 60   --rotate normal \
            --output $laptop      --mode $laptop_mode   --pos 3840x0    --rate 60   --rotate normal

        for monitor in $monitors; do
            if [ "$monitor" != "$dock_left" ] && [ "$monitor" != "$dock_center" ] && [ "$monitor" != "$laptop" ]; then
                xrandr --output "$monitor" --off
            fi
        done
else
    echo "No specific command provided or no docking station detected. Defaulting to laptop screen only."
    lap
fi